<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Financial Dashboard</title>
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    rel="stylesheet"
  />
  <style>
    /* Light Theme Design System */
    :root {
      --bg-primary: #f8fafc;
      --bg-secondary: #ffffff;
      --bg-tertiary: #f1f5f9;
      --text-primary: #0f172a;
      --text-secondary: #334155;
      --text-tertiary: #64748b;
      --accent-primary: #0284c7;
      --accent-secondary: #0ea5e9;
      --accent-tertiary: #38bdf8;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --border-color: #e2e8f0;
      --border-radius: 12px;
      --card-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
      --transition-speed: 0.3s;
      --font-primary: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
    }

    /* Base Reset */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: var(--font-primary);
    }

    body {
      background-color: var(--bg-primary);
      color: var(--text-primary);
      font-size: 16px;
      line-height: 1.5;
      overflow-x: hidden;
    }

    .dashboard {
      max-width: 1440px;
      margin: 0 auto;
      padding: 2rem;
    }

    /* Header Styling */
    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border-color);
    }

    .dashboard-title h1 {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      color: var(--accent-primary);
    }

    .dashboard-title p {
      color: var(--text-secondary);
      font-size: 1rem;
    }

    .dashboard-meta {
      display: flex;
      align-items: center;
      gap: 1.5rem;
    }

    .dashboard-meta-item {
      text-align: right;
    }

    .dashboard-meta-value {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    .dashboard-meta-label {
      font-size: 0.75rem;
      color: var(--text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    /* Card Grid System */
    .card-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    @media (max-width: 1200px) {
      .card-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 768px) {
      .card-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Card Styling */
    .card {
      background-color: var(--bg-secondary);
      border-radius: var(--border-radius);
      padding: 1.5rem;
      box-shadow: var(--card-shadow);
      transition: transform var(--transition-speed), box-shadow var(--transition-speed);
      position: relative;
      overflow: hidden;
      border: 1px solid var(--border-color);
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
    }

    .card::after {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
    }

    .card-income::after {
      background: linear-gradient(to bottom, var(--success), transparent);
    }

    .card-expense::after {
      background: linear-gradient(to bottom, var(--danger), transparent);
    }

    .card-transfer::after {
      background: linear-gradient(to bottom, var(--accent-primary), transparent);
    }

    .card-net::after {
      background: linear-gradient(to bottom, var(--accent-secondary), transparent);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 1rem;
    }

    .card-title {
      font-size: 0.875rem;
      color: var(--text-secondary);
      margin-bottom: 0.25rem;
      font-weight: 500;
    }

    .card-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.125rem;
    }

    .card-income .card-icon {
      background-color: rgba(16, 185, 129, 0.1);
      color: var(--success);
    }

    .card-expense .card-icon {
      background-color: rgba(239, 68, 68, 0.1);
      color: var(--danger);
    }

    .card-transfer .card-icon {
      background-color: rgba(14, 165, 233, 0.1);
      color: var(--accent-primary);
    }

    .card-net .card-icon {
      background-color: rgba(6, 182, 212, 0.1);
      color: var(--accent-secondary);
    }

    .card-value {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      line-height: 1.1;
    }

    .positive {
      color: var(--success);
    }

    .negative {
      color: var(--danger);
    }

    .neutral {
      color: var(--accent-primary);
    }

    .card-subtitle {
      font-size: 0.75rem;
      color: var(--text-tertiary);
    }

    /* Chart Container */
    .chart-row {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    @media (max-width: 992px) {
      .chart-row {
        grid-template-columns: 1fr;
      }
    }

    .chart-card {
      background-color: var(--bg-secondary);
      border-radius: var(--border-radius);
      padding: 1.5rem;
      box-shadow: var(--card-shadow);
      border: 1px solid var(--border-color);
    }

    .chart-header {
      margin-bottom: 1rem;
    }

    .chart-title {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
      color: var(--text-primary);
    }

    .chart-subtitle {
      font-size: 0.875rem;
      color: var(--text-tertiary);
    }

    .chart-container {
      position: relative;
      height: 320px;
      width: 100%;
      margin-top: 1rem;
      padding-bottom: 1rem;
    }

    /* Transactions Table */
    .transactions-card {
      background-color: var(--bg-secondary);
      border-radius: var(--border-radius);
      padding: 1.5rem;
      box-shadow: var(--card-shadow);
      margin-bottom: 2rem;
      border: 1px solid var(--border-color);
    }

    .transactions-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border-color);
    }

    .transactions-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    .table-container {
      overflow-x: auto;
      max-height: 500px;
      overflow-y: auto;
    }

    .transactions-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
    }

    .transactions-table th {
      background-color: var(--bg-tertiary);
      padding: 1rem;
      text-align: left;
      font-weight: 600;
      color: var(--text-secondary);
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      border-bottom: 1px solid var(--border-color);
      position: sticky;
      top: 0;
      z-index: 1;
    }

    .transactions-table th:first-child {
      border-top-left-radius: 8px;
    }

    .transactions-table th:last-child {
      border-top-right-radius: 8px;
    }

    .transactions-table td {
      padding: 1rem;
      font-size: 0.875rem;
      color: var(--text-primary);
      border-bottom: 1px solid var(--border-color);
    }

    .transactions-table tr:last-child td {
      border-bottom: none;
    }

    .transactions-table tr:hover td {
      background-color: var(--bg-tertiary);
    }

    .account-cell {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .account-icon {
      width: 2rem;
      height: 2rem;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 600;
      color: white;
      background-color: var(--text-tertiary);
    }

    .tx-badge {
      display: inline-flex;
      align-items: center;
      padding: 0.25rem 0.75rem;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 500;
    }

    .badge-deposit {
      background-color: rgba(16, 185, 129, 0.1);
      color: var(--success);
    }

    .badge-withdrawal {
      background-color: rgba(239, 68, 68, 0.1);
      color: var(--danger);
    }

    .badge-transfer {
      background-color: rgba(14, 165, 233, 0.1);
      color: var(--accent-primary);
    }

    .badge-fee {
      background-color: rgba(245, 158, 11, 0.1);
      color: var(--warning);
    }

    /* Footer */
    .dashboard-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-top: 1rem;
      border-top: 1px solid var(--border-color);
      font-size: 0.875rem;
      color: var(--text-tertiary);
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg-tertiary);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--accent-tertiary);
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--accent-primary);
    }
  </style>
</head>
<body>
  <div class="dashboard">
    <div class="dashboard-header">
      <div class="dashboard-title">
        <h1>Financial Dashboard</h1>
        <p>March 2025 Financial Data</p>
      </div>
      <div class="dashboard-meta">
        <div class="dashboard-meta-item">
          <div class="dashboard-meta-value">20</div>
          <div class="dashboard-meta-label">Transactions</div>
        </div>
        <div class="dashboard-meta-item">
          <div class="dashboard-meta-value">4</div>
          <div class="dashboard-meta-label">Accounts</div>
        </div>
      </div>
    </div>

    <div class="card-grid">
      <div class="card card-income">
        <div class="card-header">
          <div>
            <div class="card-title">TOTAL INCOME</div>
          </div>
          <div class="card-icon">
            <i class="fas fa-arrow-down"></i>
          </div>
        </div>
        <div class="card-value positive">$9,330.87</div>
        <div class="card-subtitle">March deposits</div>
      </div>

      <div class="card card-expense">
        <div class="card-header">
          <div>
            <div class="card-title">TOTAL EXPENSES</div>
          </div>
          <div class="card-icon">
            <i class="fas fa-arrow-up"></i>
          </div>
        </div>
        <div class="card-value negative">$10,364.61</div>
        <div class="card-subtitle">March withdrawals</div>
      </div>

      <div class="card card-transfer">
        <div class="card-header">
          <div>
            <div class="card-title">TRANSFERS</div>
          </div>
          <div class="card-icon">
            <i class="fas fa-exchange-alt"></i>
          </div>
        </div>
        <div class="card-value neutral">$2,983.57</div>
        <div class="card-subtitle">March transfers</div>
      </div>

      <div class="card card-net">
        <div class="card-header">
          <div>
            <div class="card-title">NET CASH FLOW</div>
          </div>
          <div class="card-icon">
            <i class="fas fa-chart-line"></i>
          </div>
        </div>
        <div class="card-value negative">-$1,033.74</div>
        <div class="card-subtitle">March net flow</div>
      </div>
    </div>

    <div class="chart-row">
      <div class="chart-card">
        <div class="chart-header">
          <div class="chart-title">Cash Flow</div>
          <div class="chart-subtitle">Income vs Expenses by Transaction Type</div>
        </div>
        <div class="chart-container">
          <!-- Inline dimensions added as fallback -->
          <canvas id="cash-flow-chart" style="width:100%; height:320px;"></canvas>
        </div>
      </div>

      <div class="chart-card">
        <div class="chart-header">
          <div class="chart-title">Account Balances</div>
          <div class="chart-subtitle">Current Balance Across All Accounts</div>
        </div>
        <div class="chart-container">
          <canvas id="accounts-chart" style="width:100%; height:320px;"></canvas>
        </div>
      </div>
    </div>

    <div class="transactions-card">
      <div class="transactions-header">
        <div class="transactions-title">Recent Transactions</div>
      </div>
      <div class="table-container">
        <table class="transactions-table" id="transactions-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Account</th>
              <th>Description</th>
              <th>Category</th>
              <th>Type</th>
              <th>Amount</th>
            </tr>
          </thead>
          <tbody>
            <!-- Rows will be inserted here by JavaScript -->
          </tbody>
        </table>
      </div>
    </div>

    <div class="dashboard-footer">
      <div>Financial Dashboard Â© 2025</div>
      <div>Data powered by Wealthica</div>
    </div>
  </div>

  <!-- Chart.js Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <script>
    window.addEventListener("load", function () {
      if (typeof Chart === "undefined") {
        console.error("Chart.js library did not load!");
        return;
      } else {
        console.log("Chart.js library loaded successfully.");
      }
      
      // Data for dashboard transactions
      const transactions = [
        { date: "3/8/25", account: "RBC Online Banking (RBC Advantage Banking)", description: "Interac purchase", category: "chequing", type: "withdrawal", amount: -14.94 },
        { date: "3/7/25", account: "RBC Online Banking (RBC Advantage Banking)", description: "e-Transfer sent 97 mayor payments T6VXW9", category: "chequing", type: "withdrawal", amount: -1000 },
        { date: "3/7/25", account: "RBC Online Banking (RBC Advantage Banking)", description: "e-Transfer sent cisco W6KZ5X", category: "chequing", type: "withdrawal", amount: -27.13 },
        { date: "3/7/25", account: "RBC Online Banking (RBC Advantage Banking)", description: "Loan payment", category: "chequing", type: "withdrawal", amount: -1045.8 },
        { date: "3/7/25", account: "CIBC (Visa Cad)", description: "PAYMENT THANK YOU/PAIEMEN T MERCI", category: "credit", type: "deposit", amount: 85.09 },
        { date: "3/7/25", account: "CIBC (Visa Cad)", description: "PAYMENT THANK YOU/PAIEMEN T MERCI", category: "credit", type: "deposit", amount: 23.56 },
        { date: "3/7/25", account: "CIBC (CIBC Smart Account)", description: "E-TRANSFER 011196490534 MATEUS SAAR", category: "chequing", type: "deposit", amount: 1000 },
        { date: "3/7/25", account: "CIBC (CIBC Smart Account)", description: "E-TRANSFER 011251719837 TIAN LIU", category: "chequing", type: "deposit", amount: 660 },
        { date: "3/6/25", account: "RBC Online Banking (RBC Advantage Banking)", description: "Misc Payment MATEUS SAAR", category: "chequing", type: "deposit", amount: 3000.79 },
        { date: "3/6/25", account: "RBC Online Banking (RBC Advantage Banking)", description: "e-Transfer sent ben didham RM9267", category: "chequing", type: "withdrawal", amount: -2000 },
        { date: "3/6/25", account: "CIBC (CIBC Smart Account)", description: "PREAUTHORIZED DEBIT NEWFOUNDLAND POWER INC.", category: "chequing", type: "withdrawal", amount: -127.55 },
        { date: "3/6/25", account: "CIBC (CIBC Smart Account)", description: "PREAUTHORIZED DEBIT NEWFOUNDLAND POWER INC.", category: "chequing", type: "withdrawal", amount: -620.59 },
        { date: "3/6/25", account: "RBC Online Banking (RBC Cash Back Mastercard)", description: "Spotify P34AC1FC36", category: "credit", type: "withdrawal", amount: -14.59 },
        { date: "3/4/25", account: "CIBC (Visa Cad)", description: "PAYMENT THANK YOU/PAIEMEN T MERCI", category: "credit", type: "deposit", amount: 100.7 },
        { date: "3/4/25", account: "CIBC (Visa Cad)", description: "PURCHASE INTEREST", category: "credit", type: "withdrawal", amount: -75.09 },
        { date: "3/3/25", account: "RBC Online Banking (RBC Advantage Banking)", description: "Misc Payment MATEUS SAAR", category: "chequing", type: "deposit", amount: 3000.79 },
        { date: "3/3/25", account: "RBC Online Banking (RBC Advantage Banking)", description: "e-Transfer sent ben didham BVRVFK", category: "chequing", type: "withdrawal", amount: -2000 },
        { date: "3/3/25", account: "RBC Online Banking (RBC Advantage Banking)", description: "e-Transfer sent chloe MTDUY6", category: "chequing", type: "withdrawal", amount: -637.5 },
        { date: "3/3/25", account: "RBC Online Banking (RBC Advantage Banking)", description: "Online Banking transfer - 5016", category: "chequing", type: "withdrawal", amount: -50 },
        { date: "3/3/25", account: "RBC Online Banking (RBC Advantage Banking)", description: "e-Transfer sent Kristof SHQKMN", category: "chequing", type: "withdrawal", amount: -30 }
      ];

      console.log("Populating transaction table...");
      populateTransactionTable();
      
      console.log("Initializing charts...");
      initializeCharts();

      // --- Function Definitions ---
      function populateTransactionTable() {
        const tableBody = document.querySelector("#transactions-table tbody");
        if (!tableBody) {
          console.error("Transaction table body not found!");
          return;
        }
        // Sort transactions by date (newest first)
        const sortedTransactions = [...transactions].sort((a, b) => new Date(b.date) - new Date(a.date));
        sortedTransactions.forEach((transaction) => {
          const row = document.createElement("tr");
          const formattedAmount = new Intl.NumberFormat("en-US", {
            style: "currency",
            currency: "USD",
            minimumFractionDigits: 2,
          }).format(transaction.amount);
          const accountName = transaction.account.split(" (")[0];
          const accountInitials = accountName
            .split(" ")
            .map((word) => word[0])
            .join("")
            .substring(0, 2)
            .toUpperCase();
          let accountColor = "#64748b";
          if (accountName.includes("RBC")) {
            accountColor = "#ef4444";
          } else if (accountName.includes("CIBC")) {
            accountColor = "#10b981";
          }
          row.innerHTML = `
            <td>${transaction.date}</td>
            <td>
              <div class="account-cell">
                <div class="account-icon" style="background-color: ${accountColor};">${accountInitials}</div>
                <div>${accountName}</div>
              </div>
            </td>
            <td>${transaction.description}</td>
            <td>${transaction.category || "Uncategorized"}</td>
            <td>
              <span class="tx-badge badge-${transaction.type}">
                ${transaction.type.charAt(0).toUpperCase() + transaction.type.slice(1)}
              </span>
            </td>
            <td class="${transaction.amount >= 0 ? "positive" : "negative"}">${formattedAmount}</td>
          `;
          tableBody.appendChild(row);
        });
      }

      function initializeCharts() {
        // Calculate account balances from transactions
        const accountMap = {};
        transactions.forEach((transaction) => {
          const accountName = transaction.account.split(" (")[0];
          if (!accountMap[accountName]) {
            accountMap[accountName] = 0;
          }
          accountMap[accountName] += transaction.amount;
        });
        const accountsData = {
          labels: Object.keys(accountMap),
          balances: Object.values(accountMap).map((balance) => parseFloat(balance.toFixed(2))),
        };

        // Log computed data for debugging
        console.log("Computed account balances:", accountsData);
        const income = transactions.filter(t => t.type === "deposit").reduce((s, t) => s + Math.abs(t.amount), 0);
        const expenses = transactions.filter(t => t.type === "withdrawal").reduce((s, t) => s + Math.abs(t.amount), 0);
        const transfers = transactions.filter(t => t.type === "transfer").reduce((s, t) => s + Math.abs(t.amount), 0);
        console.log("Cash flow amounts: Income =", income, "Expenses =", expenses, "Transfers =", transfers);

        createCashFlowChart(transactions);
        createAccountsChart(accountsData);
      }

      function createCashFlowChart(transactions) {
        const cashFlowCanvas = document.getElementById("cash-flow-chart");
        if (!cashFlowCanvas) {
          console.error("Cash flow canvas not found!");
          return;
        }
        const ctx = cashFlowCanvas.getContext("2d");
        const income = transactions
          .filter((t) => t.type === "deposit")
          .reduce((sum, t) => sum + Math.abs(t.amount), 0);
        const expenses = transactions
          .filter((t) => t.type === "withdrawal")
          .reduce((sum, t) => sum + Math.abs(t.amount), 0);
        const transfers = transactions
          .filter((t) => t.type === "transfer")
          .reduce((sum, t) => sum + Math.abs(t.amount), 0);

        try {
          new Chart(ctx, {
            type: "pie",
            data: {
              labels: ["Income", "Expenses", "Transfers"],
              datasets: [
                {
                  data: [income, expenses, transfers],
                  backgroundColor: [
                    "rgba(16, 185, 129, 0.7)",
                    "rgba(239, 68, 68, 0.7)",
                    "rgba(14, 165, 233, 0.7)",
                  ],
                  borderColor: [
                    "rgb(16, 185, 129)",
                    "rgb(239, 68, 68)",
                    "rgb(14, 165, 233)",
                  ],
                  borderWidth: 2,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  position: "top",
                  labels: { padding: 15 },
                },
                tooltip: {
                  callbacks: {
                    label: function (context) {
                      const value = context.raw;
                      return "$" + value.toLocaleString(undefined, {
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2,
                      });
                    },
                  },
                },
              },
            },
          });
          console.log("Cash flow chart created.");
        } catch (error) {
          console.error("Error creating cash flow chart:", error);
        }
      }

      function createAccountsChart(accountsData) {
        const accountsCanvas = document.getElementById("accounts-chart");
        if (!accountsCanvas) {
          console.error("Accounts canvas not found!");
          return;
        }
        const ctx = accountsCanvas.getContext("2d");
        try {
          new Chart(ctx, {
            type: "bar",
            data: {
              labels: accountsData.labels,
              datasets: [
                {
                  label: "Account Balance",
                  data: accountsData.balances,
                  backgroundColor: accountsData.balances.map((balance) =>
                    balance >= 0 ? "rgba(16, 185, 129, 0.7)" : "rgba(239, 68, 68, 0.7)"
                  ),
                  borderColor: accountsData.balances.map((balance) =>
                    balance >= 0 ? "rgb(16, 185, 129)" : "rgb(239, 68, 68)"
                  ),
                  borderWidth: 2,
                  borderRadius: 6,
                },
              ],
            },
            options: {
              indexAxis: "y",
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                x: {
                  grid: { color: "rgba(226, 232, 240, 0.5)" },
                  ticks: {
                    callback: function (value) {
                      if (value === 0) return "$0";
                      return (value > 0 ? "+$" : "-$") + Math.abs(value).toLocaleString();
                    },
                  },
                },
                y: { grid: { display: false } },
              },
              plugins: {
                legend: { display: false },
                tooltip: {
                  callbacks: {
                    title: function (context) {
                      return context[0].label + " Account";
                    },
                    label: function (context) {
                      const value = context.raw;
                      const prefix = value >= 0 ? "+" : "-";
                      return "Balance: " + prefix + "$" + Math.abs(value).toLocaleString(undefined, {
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2,
                      });
                    },
                  },
                },
              },
            },
          });
          console.log("Accounts chart created.");
        } catch (error) {
          console.error("Error creating accounts chart:", error);
        }
      }
    });
  </script>
</body>
</html>
