<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Future: Career & Life Planning</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        /* Styles from the improved version (layout, labels, etc.) */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background-color: #ffffff; /* Light background */
            color: #334155; /* Slate 700 for text */
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            font-weight: 400;
            text-rendering: optimizeLegibility;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        h1 {
            color: #1e293b; /* Slate 800 */
            margin: 20px 0;
            text-align: center;
            font-weight: 500;
            letter-spacing: -0.02em;
            font-size: 1.75rem;
        }
        
        .controls {
            margin: 10px 0 20px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
            z-index: 10;
            width: 90%;
            max-width: 900px;
        }
        
        button {
            background-color: #f1f5f9; /* Slate 100 */
            color: #334155; /* Slate 700 */
            border: 1px solid #cbd5e1; /* Slate 300 */
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.875rem;
            transition: all 0.2s ease;
            font-family: 'Inter', sans-serif;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        
        button:hover {
            background-color: #e2e8f0; /* Slate 200 */
            color: #1e293b; /* Slate 800 */
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        #graph {
            width: 100%;
            height: calc(100% - 120px); /* Adjust based on header/controls height */
            position: relative;
        }
        
        /* Node and Link styling */
        .node {
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .link {
            /* Stroke managed by JS gradient */
            stroke-opacity: 0.6;
            transition: stroke-opacity 0.3s ease, stroke-width 0.3s ease; /* Added transition */
        }
        
        .node-label text {
            pointer-events: none;
            text-anchor: middle;
            dominant-baseline: middle;
            font-weight: 400;
            fill: #1e293b; /* Slate 800 */
        }

        /* --- Improved Label Positioning --- */
        .decision .node-label { /* Target labels only for decision nodes */
             transform: translateY(-38px); /* Increased vertical offset */
        }
         .decision .node-label text {
            font-size: 9.5px; /* Slightly adjusted font size */
            line-height: 1.2;
            dominant-baseline: auto; /* Reset baseline for multi-line */
            text-anchor: middle;
         }
        
        /* Tooltip styling */
        .tooltip {
            position: absolute;
            padding: 12px 16px;
            background-color: rgba(255, 255, 255, 0.95); /* Slightly transparent */
            color: #334155;
            border-radius: 4px;
            pointer-events: none;
            opacity: 0;
            transition: all 0.2s ease;
            max-width: 280px;
            z-index: 1000;
            border: 1px solid #e2e8f0; /* Slate 200 */
            font-size: 0.875rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            backdrop-filter: blur(2px); /* Subtle blur effect */
        }
        
        .tooltip h3 {
            margin: 0 0 8px 0;
            /* Color will be set dynamically based on node category */
            font-weight: 600; /* Bolder heading */
            font-size: 1rem;
        }
        
        .tooltip p {
            margin: 0 0 6px 0;
            line-height: 1.5;
            color: #64748b; /* Slate 500 */
            font-weight: 400;
        }
        
        .tooltip p strong {
            color: #334155; /* Slate 700 */
            font-weight: 500;
        }

        /* Legend styling */
        .legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: rgba(255, 255, 255, 0.9); /* Slightly transparent */
            padding: 16px;
            border-radius: 4px;
            border: 1px solid #e2e8f0; /* Slate 200 */
            z-index: 10;
            font-size: 0.875rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            backdrop-filter: blur(2px); /* Subtle blur */
        }
        
        .legend h3 {
            margin: 0 0 12px 0;
            font-weight: 500;
            font-size: 1rem;
            color: #334155; /* Slate 700 */
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            color: #64748b; /* Slate 500 */
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
            margin-right: 12px;
            flex-shrink: 0; /* Prevent shrinking */
        }

        /* Style node groups for opacity transitions */
         .node-group {
             transition: opacity 0.3s ease;
         }
    </style>
</head>
<body>
    <div class="container">
        <h1>Our Future: Career & Life Planning</h1>
        <div class="controls">
            <button id="resetZoom">Reset View</button>
            <button id="showCareerYou">Career (You)</button>
            <button id="showCareerPartner">Career (Partner)</button>
            <button id="showLocation">Location & Home</button>
            <button id="showFinancial">Financial Goals</button>
            <button id="showPersonal">Personal Growth</button>
            <button id="showRelationship">Relationship & Family</button>
        </div>
        <div id="graph"></div>
        <div class="tooltip"></div>
        <div class="legend">
            <h3>Life Areas</h3>
             <div class="legend-item">
                <div class="legend-color" style="background-color: #3b82f6;"></div> <!-- Blue 500 -->
                <div>Career (You)</div>
            </div>
             <div class="legend-item">
                <div class="legend-color" style="background-color: #14b8a6;"></div> <!-- Teal 500 -->
                <div>Career (Partner)</div>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #22c55e;"></div> <!-- Green 500 -->
                <div>Location & Home</div>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #f59e0b;"></div> <!-- Amber 500 -->
                <div>Financial Goals</div>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #a855f7;"></div> <!-- Purple 500 -->
                <div>Personal Growth</div>
            </div>
             <div class="legend-item">
                <div class="legend-color" style="background-color: #ec4899;"></div> <!-- Pink 500 -->
                <div>Relationship & Family</div>
            </div>
        </div>
    </div>

    <script>
        // --- Data: INTEGRATING NATASHA'S DETAILS ---
        const data = {
            nodes: [
                // Root node
                { id: "Our Future Together", group: "root", level: 0 },

                // Category nodes (Life Areas)
                { id: "Career (You)", group: "category", level: 1 }, // Keep your details here
                { id: "Career (Partner)", group: "category", level: 1 },
                { id: "Location & Home", group: "category", level: 1 },
                { id: "Financial Goals", group: "category", level: 1 },
                { id: "Personal Growth", group: "category", level: 1 },
                { id: "Relationship & Family", group: "category", level: 1 },

                // --- Career (You) Nodes - Keep your specific goals ---
                { id: "Your Target Industry", group: "decision", level: 2, category: "Career (You)", details: "Explore options like Tech, Healthcare, Education, Creative..." },
                { id: "Your Desired Role", group: "decision", level: 2, category: "Career (You)", details: "Management, Specialist, Entrepreneur? What skills are needed?" },
                { id: "Your Work-Life Balance", group: "decision", level: 2, category: "Career (You)", details: "Priorities? Remote work? Flexible hours?" },
                { id: "Your Salary Goals", group: "decision", level: 2, category: "Career (You)", details: "Short-term and long-term targets based on role and location." },

                // --- Career (Partner) Nodes - Updated with Natasha's info ---
                { id: "Partner's Education", group: "decision", level: 2, category: "Career (Partner)", details: "Masters program. Key Terms: Mar 17, Jun 9, Jul 14 ('25). Practicum Spring/Fall '26 (400hrs). Expected Graduation: Feb/March 2027." },
                { id: "Partner's Practicum", group: "decision", level: 2, category: "Career (Partner)", details: "Secured placement at Jasmines (Markham). Exploring virtual options. Occurs Spring & Fall 2026." },
                { id: "Partner's Licensure", group: "decision", level: 2, category: "Career (Partner)", details: "Aiming for Psychotherapist license shortly after Feb/March 2027 graduation." },
                { id: "Partner's Future Practice", group: "decision", level: 2, category: "Career (Partner)", details: "Goal: Launch virtual private practice after graduation/licensure (post-March 2027)." },
                { id: "Partner's Work During School", group: "decision", level: 2, category: "Career (Partner)", details: "Needs part-time job or side project while in school (2025/26)." },
                // Removed generic Partner nodes, replaced with specifics above

                // --- Location & Home Nodes - Updated with Natasha's info ---
                { id: "Move to Calgary", group: "decision", level: 2, category: "Location & Home", details: "Target: End of June 2025, after finishing Ontario commitments (e.g., post-June 21 party)." },
                { id: "Ideal Future Region", group: "decision", level: 2, category: "Location & Home", details: "Calgary short/mid-term (from June '25). Long-term: Prefers 1-2hr drive from family, NOT Markham permanently." },
                { id: "Living Arrangement", group: "decision", level: 2, category: "Location & Home", details: "Requires own space - no roommates." },
                // Removed/merged Rent vs Buy, Type of Home, Commute - integrated specifics
                 { id: "Rent vs Buy", group: "decision", level: 2, category: "Location & Home", details: "Decision needed based on Calgary move & finances. Initial likely rent." }, // Kept Rent/Buy as a general decision


                // --- Financial Goals Nodes - Keep yours, maybe add wedding budget ---
                { id: "Savings Strategy", group: "decision", level: 2, category: "Financial Goals", details: "Emergency fund, retirement (RRSP/401k), down payment. Percentage goals?" },
                { id: "Investment Approach", group: "decision", level: 2, category: "Financial Goals", details: "Risk tolerance? Joint or separate investments? Robo-advisor?" },
                { id: "Debt Management", group: "decision", level: 2, category: "Financial Goals", details: "Student loans, credit cards. Payoff plan?" },
                { id: "Budgeting Together", group: "decision", level: 2, category: "Financial Goals", details: "Shared expenses? Joint accounts? Budgeting tools? Factor in budget-friendly wedding preference." },

                // --- Personal Growth Nodes - Add Natasha's needs ---
                { id: "Your Skill Development", group: "decision", level: 2, category: "Personal Growth", details: "Your individual goals (e.g., coding, languages)." }, // Kept yours
                { id: "Partner's Lifestyle Needs", group: "decision", level: 2, category: "Personal Growth", details: "Requires access to Gym, safe living space, good food/coffee options nearby." },
                { id: "Travel Aspirations", group: "decision", level: 2, category: "Personal Growth", details: "Dream destinations? Travel style (budget/luxury)? Frequency?" },
                { id: "Health & Wellness", group: "decision", level: 2, category: "Personal Growth", details: "Fitness goals, mental health practices, healthy eating habits." },
                // Removed generic 'Skill Development', split yours/partner's

                // --- Relationship & Family Nodes - Updated with Natasha's info ---
                { id: "Marriage Timeline & Style", group: "decision", level: 2, category: "Relationship & Family", details: "Timing flexible, Natasha prefers after graduation (post-Feb '27). Budget-friendly wedding desired." },
                { id: "In-Person Time", group: "decision", level: 2, category: "Relationship & Family", details: "Natasha requires regular quality in-person time together." },
                { id: "Starting a Family?", group: "decision", level: 2, category: "Relationship & Family", details: "Kids? How many? Timeline considerations?" }, // Keep general decision
                { id: "Pet Ownership", group: "decision", level: 2, category: "Relationship & Family", details: "Ready for a pet? Type? Responsibilities?" } // Keep general decision
             ],
            links: [] // Links generated below
        };

        // --- Link Generation (Automatic based on 'category' property) ---
        data.nodes.filter(node => node.group === "category").forEach(categoryNode => {
            data.links.push({ source: "Our Future Together", target: categoryNode.id, value: 1 });
        });
        data.nodes.filter(node => node.group === "decision").forEach(decisionNode => {
            // Ensure the category exists before creating the link
            if (data.nodes.some(n => n.id === decisionNode.category && n.group === 'category')) {
                data.links.push({ source: decisionNode.category, target: decisionNode.id, value: 1 });
            } else {
                console.warn(`Category "${decisionNode.category}" not found for decision node "${decisionNode.id}"`);
            }
        });

        // --- D3 Visualization Setup ---
        const graphContainer = document.getElementById('graph');
        const width = graphContainer.clientWidth;
        const height = graphContainer.clientHeight;

        const svg = d3.select("#graph")
            .append("svg")
            .attr("width", "100%")
            .attr("height", "100%")
            .attr("viewBox", [-width / 2, -height / 2, width, height])
            .call(d3.zoom().scaleExtent([0.3, 3]).on("zoom", (event) => { // Adjusted scaleExtent
                g.attr("transform", event.transform);
            }));

        // --- Improved Background Grid ---
        svg.append("defs")
            .append("pattern")
            .attr("id", "grid")
            .attr("width", 50) // Slightly larger grid squares
            .attr("height", 50)
            .attr("patternUnits", "userSpaceOnUse")
            .append("path")
            .attr("d", "M 50 0 L 0 0 0 50")
            .attr("fill", "none")
            .attr("stroke", "#e5e7eb") // Gray 200 - slightly more visible
            .attr("stroke-width", 0.8); // Slightly thicker

        svg.append("rect")
            .attr("width", width * 3) // Ensure grid covers large area when zoomed out
            .attr("height", height * 3)
            .attr("x", -width * 1.5)
            .attr("y", -height * 1.5)
            .attr("fill", "url(#grid)")
            .attr("opacity", 0.6); // Slightly more opaque

        const g = svg.append("g");

        // Color scale (same as before)
        const colorScale = d3.scaleOrdinal()
            .domain(["Career (You)", "Career (Partner)", "Location & Home", "Financial Goals", "Personal Growth", "Relationship & Family"])
            .range(["#3b82f6", "#14b8a6", "#22c55e", "#f59e0b", "#a855f7", "#ec4899"]);

        const tooltip = d3.select(".tooltip");

        // --- Adjusted Force Simulation ---
        const simulation = d3.forceSimulation(data.nodes)
            .force("link", d3.forceLink(data.links).id(d => d.id).distance(d => {
                if (d.source.group === "root") return 220; // Increased distance from root
                return 160; // Increased distance from category to decision
            }).strength(0.8)) // Slightly stronger link force
            .force("charge", d3.forceManyBody().strength(d => {
                if (d.group === "root") return -3000; // Increased repulsion for root
                if (d.group === "category") return -1800; // Increased repulsion for categories
                return -900; // Increased repulsion for decisions
            }))
            .force("x", d3.forceX().strength(0.06)) // Slightly weaker centering
            .force("y", d3.forceY().strength(0.06))
            .force("center", d3.forceCenter(0, 0))
            .force("collide", d3.forceCollide(d => {
                 // Increased collision radii
                 if (d.group === "root") return 80;
                 if (d.group === "category") return 70;
                 return 65; // Give decision labels more space
            }));

        // --- Link Rendering (with Gradients) ---
        const linkGroups = g.append("g")
            .attr("class", "links")
            .selectAll("g")
            .data(data.links)
            .enter().append("g");

        linkGroups.append("linearGradient")
            .attr("id", (d, i) => `link-gradient-${i}`)
            .attr("gradientUnits", "userSpaceOnUse")
            .attr("x1", d => d.source.x || 0) // Initial positions
            .attr("y1", d => d.source.y || 0)
            .attr("x2", d => d.target.x || 0)
            .attr("y2", d => d.target.y || 0)
            .each(function(d) {
                const gradient = d3.select(this);
                gradient.append("stop").attr("offset", "0%")
                    .attr("stop-color", () => d.source.group === "root" ? "#94a3b8" : colorScale(d.source.id))
                    .attr("stop-opacity", 0.7);
                gradient.append("stop").attr("offset", "100%")
                    .attr("stop-color", () => d.target.group === "category" ? colorScale(d.target.id) : colorScale(d.target.category))
                    .attr("stop-opacity", 0.7);
            });

        const link = linkGroups.append("path")
            .attr("class", "link")
            .attr("stroke", (d, i) => `url(#link-gradient-${i})`)
            .attr("stroke-width", 1.8) // Slightly thicker default links
            .attr("fill", "none");

        // --- Node Rendering ---
        const nodeGroups = g.append("g")
            .attr("class", "node-groups")
            .selectAll("g")
            .data(data.nodes)
            .enter().append("g")
            .attr("class", d => `node-group ${d.group}`) // Added group class here
            .call(d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended));

        // Glow filter (same as before)
        const defs = svg.append("defs");
        const glowFilter = defs.append("filter")
            .attr("id", "glow")
            .attr("x", "-50%").attr("y", "-50%")
            .attr("width", "200%").attr("height", "200%");
        glowFilter.append("feGaussianBlur").attr("stdDeviation", "2.5").attr("result", "coloredBlur"); // Slightly stronger glow
        const glowMerge = glowFilter.append("feMerge");
        glowMerge.append("feMergeNode").attr("in", "coloredBlur");
        glowMerge.append("feMergeNode").attr("in", "SourceGraphic");

        // --- Improved Node Circles ---
        const node = nodeGroups.append("g")
            .attr("class", "node-container")
            .style("transform-origin", "center center"); // For scaling transitions

        node.append("circle") // Outer circle (border)
            .attr("class", d => `node-base ${d.group}`)
            .attr("r", d => { // Slightly adjusted sizes
                if (d.group === "root") return 50;
                if (d.group === "category") return 40;
                return 25; // Decision nodes slightly larger
            })
            .attr("fill", "#ffffff")
            .attr("stroke", d => {
                if (d.group === "root") return "#475569"; // Darker Slate 600 for root border
                if (d.group === "category") return colorScale(d.id);
                return colorScale(d.category);
            })
            .attr("stroke-width", d => (d.group === 'root' ? 3.5 : (d.group === 'category' ? 3 : 2.5))) // Thicker strokes
            .attr("filter", "url(#glow)");

        node.append("circle") // Inner circle (fill)
            .attr("class", d => `node-inner ${d.group}`)
            .attr("r", d => { // Adjusted inner sizes
                if (d.group === "root") return 40;
                if (d.group === "category") return 30;
                return 18;
            })
            .attr("fill", d => {
                if (d.group === "root") return "#f1f5f9"; // Lighter Slate 100 for root fill
                if (d.group === "category") return colorScale(d.id);
                return colorScale(d.category);
            })
            .attr("opacity", 0.4); // Slightly more opaque inner circle

        // --- Node Labels ---
        const nodeLabelGroups = nodeGroups.append("g")
            .attr("class", d => `node-label ${d.group}`); // Added group class here for easier selection

        // Root node label
        nodeLabelGroups.filter(".root")
            .append("text")
            .text(d => d.id)
            .attr("fill", "#1e293b") // Slate 800
            .attr("font-size", "15px")
            .attr("text-anchor", "middle")
            .attr("dominant-baseline", "middle")
            .attr("font-weight", "600"); // Bolder root label

        // Category node labels
        nodeLabelGroups.filter(".category")
            .each(function(d) {
                const words = d.id.split(/[\s&]+/); // Split on space or ampersand
                const el = d3.select(this);
                 // Simple two-line split logic
                if (words.length > 1) {
                    const line1 = words[0];
                    const line2 = words.slice(1).join(' ');
                     el.append("text").text(line1).attr("dy", "-0.35em").attr("font-size", "12px").attr("text-anchor", "middle").attr("font-weight", "500");
                     el.append("text").text(line2).attr("dy", "0.95em").attr("font-size", "12px").attr("text-anchor", "middle").attr("font-weight", "500");
                } else {
                     el.append("text").text(d.id).attr("font-size", "12px").attr("text-anchor", "middle").attr("dominant-baseline", "middle").attr("font-weight", "500");
                }
            });

        // --- Improved Decision Node Labels (Multi-line) ---
        nodeLabelGroups.filter(".decision")
            .each(function(d) {
                const words = d.id.split(' ');
                const el = d3.select(this);
                const maxCharsPerLine = 15; // Adjust as needed
                let lines = [];
                let currentLine = "";

                words.forEach(word => {
                    if (currentLine.length === 0) {
                        currentLine = word;
                    } else if (currentLine.length + word.length + 1 <= maxCharsPerLine) {
                        currentLine += " " + word;
                    } else {
                        lines.push(currentLine);
                        currentLine = word;
                    }
                });
                lines.push(currentLine); // Add the last line

                const lineHeight = 1.2; // em
                const startY = -(lines.length - 1) * 0.5 * lineHeight; // Center vertically

                lines.forEach((line, i) => {
                    el.append("text")
                        .text(line)
                        .attr("dy", `${startY + i * lineHeight}em`) // Position each line
                        .attr("text-anchor", "middle");
                        // Inherits font-size/etc from CSS rule .decision .node-label text
                });
            });

        // --- Simulation Tick ---
        simulation.on("tick", () => {
            link.attr("d", d => {
                 // Check if source and target have coordinates
                 if (d.source.x === undefined || d.target.x === undefined) {
                     return null; // Don't draw link if nodes haven't been positioned
                 }
                 const dx = d.target.x - d.source.x;
                 const dy = d.target.y - d.source.y;
                 // Increased curve factor for more separation
                 const dr = Math.sqrt(dx * dx + dy * dy) * 1.8;
                 return `M${d.source.x},${d.source.y}A${dr},${dr} 0 0,1 ${d.target.x},${d.target.y}`;
             });

            // Update link gradient endpoints
             d3.selectAll(".links linearGradient")
                 .attr("x1", d => d.source.x).attr("y1", d => d.source.y)
                 .attr("x2", d => d.target.x).attr("y2", d => d.target.y);

            nodeGroups.attr("transform", d => `translate(${d.x || 0}, ${d.y || 0})`); // Handle potential undefined x/y initially
        });

        // --- Interaction Functions ---
        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
            d3.select(this).raise(); // Bring dragged node to front
        }

        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }

        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0); // Cool down
            // Keep position fixed if user explicitly moved it
            // d.fx = null;
            // d.fy = null;
        }

        // --- Improved Hover Effects ---
        nodeGroups.on("mouseover", function(event, d) {
            const thisNodeGroup = d3.select(this);
            thisNodeGroup.raise(); // Bring hovered node group to front

             // Scale up the hovered node slightly
             thisNodeGroup.select('.node-container')
                .transition().duration(150)
                .attr('transform', 'scale(1.1)');

            const relatedLinks = data.links.filter(link => link.source.id === d.id || link.target.id === d.id);
            const relatedNodeIds = new Set();
            relatedLinks.forEach(link => {
                // Check if source/target are objects (as d3 might replace ids with objects)
                const sourceId = typeof link.source === 'object' ? link.source.id : link.source;
                const targetId = typeof link.target === 'object' ? link.target.id : link.target;
                relatedNodeIds.add(sourceId);
                relatedNodeIds.add(targetId);
            });
            relatedNodeIds.add(d.id);

            // Fade out non-related items
             g.selectAll(".link")
                .transition().duration(150)
                .style("stroke-opacity", link => relatedLinks.includes(link) ? 0.9 : 0.05)
                .style("stroke-width", link => relatedLinks.includes(link) ? 3 : 1);

             g.selectAll(".node-group")
                .transition().duration(150)
                .style("opacity", node => relatedNodeIds.has(node.id) ? 1 : 0.1);

            // Show tooltip
            let tooltipContent = '';
            let nodeColor = '#64748b';
            if (d.group === "category") {
                 tooltipContent = `<h3>${d.id}</h3><p>Area of focus. Click to highlight.</p>`;
                 nodeColor = colorScale(d.id);
            } else if (d.group === "decision") {
                 tooltipContent = `<h3>${d.id}</h3><p><strong>Category:</strong> ${d.category}</p><p><strong>Details:</strong> ${d.details || 'Discuss details...'}</p>`; // Changed 'Considerations' to 'Details'
                 nodeColor = colorScale(d.category);
            } else if (d.group === "root") {
                tooltipContent = `<h3>${d.id}</h3><p>Central hub for our joint planning.</p>`;
            }
            if (tooltipContent) {
                tooltip
                    .style("opacity", 1)
                    .html(tooltipContent)
                    .style("left", (event.pageX + 15) + "px")
                    .style("top", (event.pageY - 28) + "px")
                    .style("border", `1px solid ${nodeColor}`)
                    .select("h3").style("color", nodeColor);
            }
        })
        .on("mouseout", function() {
            // Restore default styles
            g.selectAll(".link")
                .transition().duration(200)
                .style("stroke-opacity", 0.6)
                .style("stroke-width", 1.8);

            g.selectAll(".node-group")
                .transition().duration(200)
                .style("opacity", 1) // Restore opacity
                .select('.node-container') // Select the container to reset scale
                .attr('transform', 'scale(1)'); // Reset scale

            tooltip.style("opacity", 0);
        })
        .on("click", function(event, d) {
            if (d.group === "category") {
                highlightCategory(d.id);
                 event.stopPropagation();
            } else if (d.group === 'root') {
                 resetHighlightsAndZoom();
            }
        });

        // --- Button Interactions ---
        const zoom = d3.zoom().scaleExtent([0.3, 3]).on("zoom", (event) => {
             g.attr("transform", event.transform);
         });

         svg.call(zoom);

         function resetHighlightsAndZoom() {
             svg.transition().duration(750)
                 .call(zoom.transform, d3.zoomIdentity);

             g.selectAll(".node-group")
                .transition().duration(300)
                .style("opacity", 1)
                .select('.node-container')
                .attr('transform', 'scale(1)');

             g.selectAll(".link")
                .transition().duration(300)
                .style("stroke-opacity", 0.6)
                .style("stroke-width", 1.8);

             data.nodes.forEach(n => { n.fx = null; n.fy = null; });
             simulation.alphaTarget(0.1).restart();
         }

        d3.select("#resetZoom").on("click", resetHighlightsAndZoom);

        function highlightCategory(category) {
            const categoryColor = colorScale(category);
            const relatedNodeIds = new Set([ "Our Future Together", category ]);
            data.nodes.filter(n => n.category === category).forEach(n => relatedNodeIds.add(n.id));

             g.selectAll(".node-group")
                 .transition().duration(300)
                 .style("opacity", node => relatedNodeIds.has(node.id) ? 1 : 0.1)
                 .select('.node-container')
                 .attr('transform', node => node.id === category ? 'scale(1.15)' : 'scale(1)');

             g.selectAll(".link")
                 .transition().duration(300)
                 .style("stroke-opacity", link => {
                     const sourceId = typeof link.source === 'object' ? link.source.id : link.source;
                     const targetId = typeof link.target === 'object' ? link.target.id : link.target;
                     return (sourceId === "Our Future Together" && targetId === category) || (sourceId === category)
                         ? 0.9 : 0.05;
                 })
                 .style("stroke-width", link => {
                     const sourceId = typeof link.source === 'object' ? link.source.id : link.source;
                     const targetId = typeof link.target === 'object' ? link.target.id : link.target;
                     return (sourceId === "Our Future Together" && targetId === category) || (sourceId === category)
                         ? 3 : 1;
                 });
         }

        // Connect buttons to highlight function
        d3.select("#showCareerYou").on("click", () => highlightCategory("Career (You)"));
        d3.select("#showCareerPartner").on("click", () => highlightCategory("Career (Partner)"));
        d3.select("#showLocation").on("click", () => highlightCategory("Location & Home"));
        d3.select("#showFinancial").on("click", () => highlightCategory("Financial Goals"));
        d3.select("#showPersonal").on("click", () => highlightCategory("Personal Growth"));
        d3.select("#showRelationship").on("click", () => highlightCategory("Relationship & Family"));

        // Initial simulation start with slightly higher alpha
        simulation.alpha(1.2).restart();

    </script>
</body>
</html>
